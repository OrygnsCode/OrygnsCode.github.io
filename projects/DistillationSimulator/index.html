<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Distillation Column Simulator</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\$', '\\$'], ['`','`']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
</head>
<body>
    <header>
        <h1>Distillation Simulator</h1>
        <p>Version 1.0 - Advanced Chemical Engineering Tool</p>
    </header>

    <nav id="tabs">
        <button class="tab-button active" data-tab="simulator">Simulator</button>
        <button class="tab-button" data-tab="theory">Theory</button>
        <button class="tab-button" data-tab="component-data">Component Data</button>
    </nav>

    <main>
        <section id="simulator-content" class="tab-content active">
            <h2>Simulator</h2>
            <div class="app-container">
                <div class="simulator-layout">
                    <div class="control-panel">
                        <h3>Input Parameters</h3>
                        <label for="feedRate">Feed Rate (F) <span class="info-icon" data-tooltip="Total molar flow rate of the feed into the column (e.g., mol/hr). Typical values: 10-1000.">?</span></label>
                        <input type="number" id="feedRate" value="100">
                        <label for="feedComposition">Feed Composition (z<sub>F</sub>) <span class="info-icon" data-tooltip="Mole fraction of the more volatile component in the feed. Range: 0.01 to 0.99.">?</span></label>
                        <input type="range" id="feedComposition" min="0.01" max="0.99" step="0.01" value="0.5">
                        <span id="feedCompositionValue">0.50</span>

                        <label for="qValue">Feed Condition (q) <span class="info-icon" data-tooltip="Thermal condition of the feed. Examples: q=1 (sat. liquid), q=0 (sat. vapor), 0<q<1 (liquid-vapor mix), q>1 (subcooled liquid), q<0 (superheated vapor).">?</span></label>
                        <input type="number" id="qValue" step="0.1" value="1.0">

                        <label for="distillateComposition">Distillate Composition (x<sub>D</sub>) <span class="info-icon" data-tooltip="Desired mole fraction of the more volatile component in the distillate product. Range: 0.01 to 0.99. Must be > xB and > zF (typically).">?</span></label>
                        <input type="range" id="distillateComposition" min="0.01" max="0.99" step="0.01" value="0.95">
                        <span id="distillateCompositionValue">0.95</span>

                        <label for="bottomsComposition">Bottoms Composition (x<sub>B</sub>) <span class="info-icon" data-tooltip="Desired mole fraction of the more volatile component in the bottoms product. Range: 0.01 to 0.99. Must be < xD and < zF (typically).">?</span></label>
                        <input type="range" id="bottomsComposition" min="0.01" max="0.99" step="0.01" value="0.05">
                        <span id="bottomsCompositionValue">0.05</span>

                        <label for="refluxRatio">Reflux Ratio (R) <span class="info-icon" data-tooltip="Ratio of liquid returned as reflux to the distillate product withdrawn (L/D). Must be > Rmin for separation. Typical: 1.1*Rmin to 1.5*Rmin or higher.">?</span></label>
                        <input type="number" id="refluxRatio" step="0.1" value="1.5" min="0">

                        <label for="relativeVolatility">Relative Volatility (α) <span class="info-icon" data-tooltip="Measure of separability. Ratio of K-values (K_A/K_B). Must be > 1 for separation. Higher alpha means easier separation.">?</span></label>
                        <input type="number" id="relativeVolatility" step="0.01" value="2.5" min="0.01">
                    </div>
                    <div class="visualization-panel">
                        <h3>McCabe-Thiele Diagram</h3>
                        <div class="diagram-controls" style="margin-bottom: 10px; display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                            <label for="showGridCheckbox" style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 0.9em; font-weight: normal;">
                                <input type="checkbox" id="showGridCheckbox" style="margin-right: 5px;">Show Grid
                            </label>
                            <button id="resetViewButton" class="button" style="margin-left: 15px;">Reset View</button>
                        </div>
                        <div id="mccabe-thiele-diagram"></div>
                        <div class="results-grid">
                            <!-- Results will be displayed here -->
                        </div>
                        <div class="legend">
                            <!-- Diagram legend -->
                        </div>
                        <div class="export-buttons" style="margin-top: 20px; padding-top:15px; border-top: 1px solid var(--border-color); display: flex; flex-wrap: wrap; gap: 10px;">
                            <button id="exportSVGButton" class="button">Export SVG</button>
                            <button id="exportPNGButton" class="button">Export PNG</button>
                            <button id="exportCSVButton" class="button">Export CSV</button>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px; padding-top:15px; border-top: 1px solid var(--border-color);">
                    <button id="toggleStageDataButton" class="button">Show Stage-by-Stage Data</button>
                    <div id="stageDataTableContainer" style="display: none; margin-top: 15px; max-height: 300px; overflow-y: auto;">
                        <h4>Stage-by-Stage Compositions</h4>
                        <p><small>(Stage 1 is the condenser/topmost theoretical plate)</small></p>
                        <table id="stageDataTable" class="data-table">
                            <thead>
                                <tr>
                                    <th>Stage #</th>
                                    <th>Liquid (x<sub>n</sub>)</th>
                                    <th>Vapor (y<sub>n</sub>)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data populated by script.js -->
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </section>

        <section id="theory-content" class="tab-content">
            <h3>Theory of the McCabe-Thiele Method</h3>
            <hr>
            <h4>1. Purpose</h4>
            <p>The McCabe-Thiele (M-T) diagram is the fastest engineering tool for estimating how many <strong>theoretical equilibrium stages</strong> are required to separate a binary mixture by distillation under constant-molar-overflow (CMO) conditions. It provides a first-pass plate count and shows how operating choices—reflux and feed quality—drive energy and capital cost.</p>
            <hr>
            <h4>2. Core Assumptions</h4>
            <ol>
                <li><strong>Binary system</strong> (components A &amp; B)</li>
                <li><strong>Constant pressure</strong>; column is adiabatic</li>
                <li><strong>Constant molar overflow</strong> in rectifying and stripping sections</li>
                <li><strong>Each stage reaches liquid–vapour equilibrium</strong></li>
                <li>Negligible heat of mixing and tray-pressure drops</li>
            </ol>
            <hr>
            <h4>3. Equilibrium Relation</h4>
            <p>For Raoult-law mixtures with constant relative volatility <code>α</code>:</p>
            <p>$$ y = \frac{\alpha x}{1 + (\alpha - 1)x} $$</p>
            <p><code>x</code>, <code>y</code> are mole fractions of the more-volatile component in liquid and vapour.</p>
            <hr>
            <h4>4. Operating Lines</h4>
            <table>
                <thead>
                    <tr>
                        <th>Section</th>
                        <th>Equation (slope–intercept)</th>
                        <th>Key variables</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Rectifying</strong></td>
                        <td><code>y = (R / (R + 1)) x + x<sub>D</sub> / (R + 1)</code></td>
                        <td>R = reflux ratio (L/D), <code>x<sub>D</sub></code> = distillate composition</td>
                    </tr>
                    <tr>
                        <td><strong>Stripping</strong></td>
                        <td><code>y = (L&#772; / V&#772;) x – (B x<sub>B</sub>) / V&#772;</code></td>
                        <td><code>x<sub>B</sub></code> = bottoms composition; <code>L&#772;</code>, <code>V&#772;</code> = liquid/vapour rates</td>
                    </tr>
                </tbody>
            </table>
            <hr>
            <h4>5. Feed (q-) Line</h4>
            <p>$$ y = \frac{q}{q – 1}x – \frac{z_F}{q – 1} $$</p>
            <table>
                <thead>
                    <tr>
                        <th>q-value</th>
                        <th>Feed condition</th>
                        <th>Graphical slope</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>q &gt; 1</td>
                        <td>Sub-cooled liquid</td>
                        <td>Steep positive</td>
                    </tr>
                    <tr>
                        <td>q = 1</td>
                        <td>Saturated liquid</td>
                        <td>Vertical at <code>x = z<sub>F</sub></code></td>
                    </tr>
                    <tr>
                        <td>0 &lt; q &lt; 1</td>
                        <td>Two-phase feed</td>
                        <td>Moderately positive</td>
                    </tr>
                    <tr>
                        <td>q = 0</td>
                        <td>Saturated vapour</td>
                        <td>Horizontal at <code>y = z<sub>F</sub></code></td>
                    </tr>
                    <tr>
                        <td>q &lt; 0</td>
                        <td>Super-heated vapour</td>
                        <td>Negative</td>
                    </tr>
                </tbody>
            </table>
            <hr>
            <h4>6. Design Parameters</h4>
            <table>
                <thead>
                    <tr>
                        <th>Symbol</th>
                        <th>Meaning</th>
                        <th>Design insight</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong><code>α</code></strong></td>
                        <td>Relative volatility</td>
                        <td><code>α</code> &gt; 1.4 is usually economical</td>
                    </tr>
                    <tr>
                        <td><strong>R</strong></td>
                        <td>Reflux ratio = L/D</td>
                        <td>↑R → ↓stage count but ↑condenser/reboiler duty</td>
                    </tr>
                    <tr>
                        <td><strong><code>R<sub>min</sub></code></strong></td>
                        <td>Minimum reflux</td>
                        <td>Operate at ≈1.1–1.5 × <code>R<sub>min</sub></code> for good cost balance</td>
                    </tr>
                </tbody>
            </table>
            <hr>
            <h4>7. From Theory to Hardware</h4>
            <p>Overall efficiency <strong><code>E<sub>o</sub></code></strong>:</p>
            <p>$$ N_{actual} = \frac{N_{theoretical}}{E_o} $$</p>
            <p>Typical <strong><code>E<sub>o</sub></code></strong> values: 0.3 – 0.9 (system-dependent).</p>
            <p>Murphree vapour-phase efficiency <strong><code>E<sub>M,V</sub></code></strong>:</p>
            <p>$$ E_{MV} = \frac{y_n − y_{n+1}}{y_n^* − y_{n+1}} $$</p>
            <p>Use plate-by-plate efficiencies when hydraulic or pilot-plant data are available. (Note: in the equation above, <code>y<sub>n</sub></code>, <code>y<sub>n+1</sub></code>, and <code>y<sub>n</sub>*</code> are implied from context).</p>
            <hr>
            <h4>8. Using This Simulator</h4>
            <ol>
                <li><strong>Select components</strong> and supply either <code>α</code> or full VLE data.</li>
                <li><strong>Specify compositions:</strong> feed (<code>z<sub>F</sub></code>), distillate (<code>x<sub>D</sub></code>), bottoms (<code>x<sub>B</sub></code>) and <strong>feed quality</strong> (q).</li>
                <li><strong>Choose a reflux ratio</strong> or let the tool compute <code>R<sub>min</sub></code> and suggest R ≈ 1.2 <code>R<sub>min</sub></code>.</li>
                <li><strong>Read the stepped stage count</strong> on the M-T plot; apply efficiency to find the real plate count.</li>
                <li><strong>Iterate</strong> to evaluate energy vs. capital trade-offs or check sensitivity to feed condition.</li>
            </ol>
            <hr>
            <p>© 2025 OrygnsCode — Updated 17 Jun 2025</p>
        </section>

        <section id="component-data-content" class="tab-content">
            <h2>Component Data</h2>
            <label for="component-select">Select Component System:</label>
            <select id="component-select">
                <!-- Options will be populated by script.js, including "Custom Alpha" -->
            </select>
            <div id="system-properties">
                <!-- Properties for the selected system will be displayed here -->
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 OrygnsCode</p>
    </footer>

    <script src="script.js"></script>
</body>
</html>
